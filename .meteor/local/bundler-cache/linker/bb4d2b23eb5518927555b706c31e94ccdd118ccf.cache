[{"type":"js","data":"//////////////////////////////////////////////////////////////////////////\n//                                                                      //\n// This is a generated file. You can view the original                  //\n// source in your browser if your browser supports source maps.         //\n// Source maps are supported by all recent versions of Chrome, Safari,  //\n// and Firefox, and by Internet Explorer 11.                            //\n//                                                                      //\n//////////////////////////////////////////////////////////////////////////\n\n\n(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar Astro = Package['jagi:astronomy'].Astro;\nvar Astronomy = Package['jagi:astronomy'].Astronomy;\nvar _ = Package.underscore._;\nvar Tracker = Package.tracker.Tracker;\nvar Deps = Package.tracker.Deps;\n\n/* Package-scope variables */\nvar relationsOnInitModule, relationsOnInitClass, relationsOnInitInstance;\n\n(function(){\n\n////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                        //\n// packages/jagi_astronomy-relations/packages/jagi_astronomy-relations.js                 //\n//                                                                                        //\n////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                          //\n(function () {                                                                            // 1\n                                                                                          // 2\n/////////////////////////////////////////////////////////////////////////////////////     // 3\n//                                                                                 //     // 4\n// packages/jagi:astronomy-relations/lib/module/init_module.js                     //     // 5\n//                                                                                 //     // 6\n/////////////////////////////////////////////////////////////////////////////////////     // 7\n                                                                                   //     // 8\nvar methods = {};                                                                  // 1   // 9\n                                                                                   // 2   // 10\nmethods.setRelated = function(relationName, value) {};                             // 3   // 11\n                                                                                   // 4   // 12\nmethods.getRelated = function(relationName) {                                      // 5   // 13\n  // If there is already a reference to the relation object(s) stored in the       // 6   // 14\n  // \"_references\" object then we can take it without looking in collection.       // 7   // 15\n  if (_.has(this._references, relationName)) {                                     // 8   // 16\n    return this._references[relationName];                                         // 9   // 17\n  }                                                                                // 10  // 18\n                                                                                   // 11  // 19\n  // Look for the relation definition in this and parent classes.                  // 12  // 20\n  var relation = Astro.utils.class.findInClass(this.constructor, function(Class) { // 13  // 21\n    return Class.getRelation(relationName);                                        // 14  // 22\n  });                                                                              // 15  // 23\n  if (!relation) {                                                                 // 16  // 24\n    return;                                                                        // 17  // 25\n  }                                                                                // 18  // 26\n                                                                                   // 19  // 27\n  // Get a collection defined in the relation.                                     // 20  // 28\n  var ForeignClass = Astro.classes[relation.class];                                // 21  // 29\n  var ForeignCollection = ForeignClass.getCollection();                            // 22  // 30\n                                                                                   // 23  // 31\n  // Prepare selector to select only these documents that much the relation.       // 24  // 32\n  var selector = {};                                                               // 25  // 33\n  selector[relation.foreign] = this.get(relation.local);                           // 26  // 34\n                                                                                   // 27  // 35\n  // Get a related object.                                                         // 28  // 36\n  var related;                                                                     // 29  // 37\n  if (relation.type === 'one') {                                                   // 30  // 38\n    related = ForeignCollection.findOne(selector);                                 // 31  // 39\n  } else if (relation.type === 'many') {                                           // 32  // 40\n    related = ForeignCollection.find(selector);                                    // 33  // 41\n  }                                                                                // 34  // 42\n                                                                                   // 35  // 43\n  // Assing the related object to the \"_references\" object for further use.        // 36  // 44\n  return this._references[relationName] = related;                                 // 37  // 45\n};                                                                                 // 38  // 46\n                                                                                   // 39  // 47\nrelationsOnInitModule = function() {                                               // 40  // 48\n  _.extend(Astro.BaseClass.prototype, methods);                                    // 41  // 49\n};                                                                                 // 42  // 50\n                                                                                   // 43  // 51\n/////////////////////////////////////////////////////////////////////////////////////     // 52\n                                                                                          // 53\n}).call(this);                                                                            // 54\n                                                                                          // 55\n                                                                                          // 56\n                                                                                          // 57\n                                                                                          // 58\n                                                                                          // 59\n                                                                                          // 60\n(function () {                                                                            // 61\n                                                                                          // 62\n/////////////////////////////////////////////////////////////////////////////////////     // 63\n//                                                                                 //     // 64\n// packages/jagi:astronomy-relations/lib/module/init_class.js                      //     // 65\n//                                                                                 //     // 66\n/////////////////////////////////////////////////////////////////////////////////////     // 67\n                                                                                   //     // 68\nvar checks = {};                                                                   // 1   // 69\n                                                                                   // 2   // 70\nchecks.relationName = function(relationName) {                                     // 3   // 71\n  // Check if the field name had been provided and is a string.                    // 4   // 72\n  if (!_.isString(relationName)) {                                                 // 5   // 73\n    throw new Error(                                                               // 6   // 74\n      'The relation name in the \"' + this.getName() +                              // 7   // 75\n      '\" class schema has to be a string'                                          // 8   // 76\n    );                                                                             // 9   // 77\n  }                                                                                // 10  // 78\n};                                                                                 // 11  // 79\n                                                                                   // 12  // 80\nchecks.definitions = function(relationsDefinition) {                               // 13  // 81\n  if (!_.isObject(relationsDefinition)) {                                          // 14  // 82\n    // Relations definition has to be an object.                                   // 15  // 83\n    throw new Error(                                                               // 16  // 84\n      'The relations definition in the \"' + this.getName() +                       // 17  // 85\n      '\" class schema has to be an object'                                         // 18  // 86\n    );                                                                             // 19  // 87\n  }                                                                                // 20  // 88\n};                                                                                 // 21  // 89\n                                                                                   // 22  // 90\nchecks.definition = function(relationName, relationDefinition) {                   // 23  // 91\n  if (!_.isObject(relationDefinition)) {                                           // 24  // 92\n    // Relation definition has to be an object.                                    // 25  // 93\n    throw new Error(                                                               // 26  // 94\n      'The relation definition for the \"' + relationName +                         // 27  // 95\n      '\" relation in the \"' + this.getName() +                                     // 28  // 96\n      '\" class schema has to be an object'                                         // 29  // 97\n    );                                                                             // 30  // 98\n  }                                                                                // 31  // 99\n                                                                                   // 32  // 100\n  if (relationDefinition.type !== 'one' && relationDefinition.type !== 'many') {   // 33  // 101\n    // Relation type should be one of two values: \"one\" or \"many\".                 // 34  // 102\n    throw new Error(                                                               // 35  // 103\n      'The relation type for the \"' + relationName +                               // 36  // 104\n      '\" relation in the \"' + this.getName() +                                     // 37  // 105\n      '\" class schema should be \"one\" or \"many\"'                                   // 38  // 106\n    );                                                                             // 39  // 107\n  }                                                                                // 40  // 108\n};                                                                                 // 41  // 109\n                                                                                   // 42  // 110\nvar methods = {};                                                                  // 43  // 111\n                                                                                   // 44  // 112\nmethods.hasRelation = function(relationName) {                                     // 45  // 113\n  checks.relationName.call(this, relationName);                                    // 46  // 114\n                                                                                   // 47  // 115\n  return _.has(this.schema.relations, relationName);                               // 48  // 116\n};                                                                                 // 49  // 117\n                                                                                   // 50  // 118\nmethods.getRelation = function(relationName) {                                     // 51  // 119\n  checks.relationName.call(this, relationName);                                    // 52  // 120\n                                                                                   // 53  // 121\n  return this.schema.relations[relationName];                                      // 54  // 122\n};                                                                                 // 55  // 123\n                                                                                   // 56  // 124\nmethods.getRelations = function() {                                                // 57  // 125\n  return this.schema.relations;                                                    // 58  // 126\n};                                                                                 // 59  // 127\n                                                                                   // 60  // 128\nmethods.addRelations = function(relationsDefinition) {                             // 61  // 129\n  checks.definitions.call(this, relationsDefinition);                              // 62  // 130\n                                                                                   // 63  // 131\n  _.each(relationsDefinition, function(relationDefinition, relationName) {         // 64  // 132\n    this.addRelation(relationName, relationsDefinition[relationName]);             // 65  // 133\n  }, this);                                                                        // 66  // 134\n};                                                                                 // 67  // 135\n                                                                                   // 68  // 136\n                                                                                   // 69  // 137\nmethods.addRelation = function(relationName, relationDefinition) {                 // 70  // 138\n  // Do params checking. The params checking can throw an error.                   // 71  // 139\n  checks.relationName.call(this, relationName);                                    // 72  // 140\n  // If the relation already exists then just break. When adding relation, we also try to add an opposit relation to the foreign schema. It could cause circular method execution. It's why we have to stop execution.\n  if (this.hasRelation(relationName)) {                                            // 74  // 142\n    return;                                                                        // 75  // 143\n  }                                                                                // 76  // 144\n  checks.definition.call(this, relationName, relationDefinition);                  // 77  // 145\n                                                                                   // 78  // 146\n  // Define setter and getter for the relation.                                    // 79  // 147\n  Object.defineProperty(this.prototype, relationName, {                            // 80  // 148\n    get: function() {                                                              // 81  // 149\n      return this.getRelated(relationName);                                        // 82  // 150\n    },                                                                             // 83  // 151\n    set: function(value) {                                                         // 84  // 152\n      this.setRelated(relationName, value);                                        // 85  // 153\n    }                                                                              // 86  // 154\n  });                                                                              // 87  // 155\n                                                                                   // 88  // 156\n  // Add relation definition to the schema.                                        // 89  // 157\n  this.schema.relations[relationName] = relationDefinition;                        // 90  // 158\n};                                                                                 // 91  // 159\n                                                                                   // 92  // 160\nrelationsOnInitClass = function(schemaDefinition) {                                // 93  // 161\n  var Class = this;                                                                // 94  // 162\n                                                                                   // 95  // 163\n  _.extend(Class, methods);                                                        // 96  // 164\n                                                                                   // 97  // 165\n  // Add the \"relations\" attribute to the schema.                                  // 98  // 166\n  Class.schema.relations = {};                                                     // 99  // 167\n                                                                                   // 100\n  if (_.has(schemaDefinition, 'relations')) {                                      // 101\n    Class.addRelations(schemaDefinition.relations);                                // 102\n  }                                                                                // 103\n};                                                                                 // 104\n                                                                                   // 105\n/////////////////////////////////////////////////////////////////////////////////////     // 174\n                                                                                          // 175\n}).call(this);                                                                            // 176\n                                                                                          // 177\n                                                                                          // 178\n                                                                                          // 179\n                                                                                          // 180\n                                                                                          // 181\n                                                                                          // 182\n(function () {                                                                            // 183\n                                                                                          // 184\n/////////////////////////////////////////////////////////////////////////////////////     // 185\n//                                                                                 //     // 186\n// packages/jagi:astronomy-relations/lib/module/init_instance.js                   //     // 187\n//                                                                                 //     // 188\n/////////////////////////////////////////////////////////////////////////////////////     // 189\n                                                                                   //     // 190\nrelationsOnInitInstance = function() {                                             // 1   // 191\n  // Object for storing references of related objects.                             // 2   // 192\n  this._references = {};                                                           // 3   // 193\n};                                                                                 // 4   // 194\n                                                                                   // 5   // 195\n/////////////////////////////////////////////////////////////////////////////////////     // 196\n                                                                                          // 197\n}).call(this);                                                                            // 198\n                                                                                          // 199\n                                                                                          // 200\n                                                                                          // 201\n                                                                                          // 202\n                                                                                          // 203\n                                                                                          // 204\n(function () {                                                                            // 205\n                                                                                          // 206\n/////////////////////////////////////////////////////////////////////////////////////     // 207\n//                                                                                 //     // 208\n// packages/jagi:astronomy-relations/lib/module/module.js                          //     // 209\n//                                                                                 //     // 210\n/////////////////////////////////////////////////////////////////////////////////////     // 211\n                                                                                   //     // 212\nAstro.createModule({                                                               // 1   // 213\n  name: 'relations',                                                               // 2   // 214\n  init: relationsOnInitModule,                                                     // 3   // 215\n  events: {                                                                        // 4   // 216\n    initclass: relationsOnInitClass,                                               // 5   // 217\n    initinstance: relationsOnInitInstance                                          // 6   // 218\n  }                                                                                // 7   // 219\n});                                                                                // 8   // 220\n                                                                                   // 9   // 221\n/////////////////////////////////////////////////////////////////////////////////////     // 222\n                                                                                          // 223\n}).call(this);                                                                            // 224\n                                                                                          // 225\n////////////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n/* Exports */\nif (typeof Package === 'undefined') Package = {};\nPackage['jagi:astronomy-relations'] = {};\n\n})();\n","servePath":"/packages/jagi_astronomy-relations.js","sourceMap":{"version":3,"sources":["/packages/jagi_astronomy-relations/packages/jagi_astronomy-relations.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gG","file":"/packages/jagi_astronomy-relations.js","sourcesContent":["(function () {\n\n/////////////////////////////////////////////////////////////////////////////////////\n//                                                                                 //\n// packages/jagi:astronomy-relations/lib/module/init_module.js                     //\n//                                                                                 //\n/////////////////////////////////////////////////////////////////////////////////////\n                                                                                   //\nvar methods = {};                                                                  // 1\n                                                                                   // 2\nmethods.setRelated = function(relationName, value) {};                             // 3\n                                                                                   // 4\nmethods.getRelated = function(relationName) {                                      // 5\n  // If there is already a reference to the relation object(s) stored in the       // 6\n  // \"_references\" object then we can take it without looking in collection.       // 7\n  if (_.has(this._references, relationName)) {                                     // 8\n    return this._references[relationName];                                         // 9\n  }                                                                                // 10\n                                                                                   // 11\n  // Look for the relation definition in this and parent classes.                  // 12\n  var relation = Astro.utils.class.findInClass(this.constructor, function(Class) { // 13\n    return Class.getRelation(relationName);                                        // 14\n  });                                                                              // 15\n  if (!relation) {                                                                 // 16\n    return;                                                                        // 17\n  }                                                                                // 18\n                                                                                   // 19\n  // Get a collection defined in the relation.                                     // 20\n  var ForeignClass = Astro.classes[relation.class];                                // 21\n  var ForeignCollection = ForeignClass.getCollection();                            // 22\n                                                                                   // 23\n  // Prepare selector to select only these documents that much the relation.       // 24\n  var selector = {};                                                               // 25\n  selector[relation.foreign] = this.get(relation.local);                           // 26\n                                                                                   // 27\n  // Get a related object.                                                         // 28\n  var related;                                                                     // 29\n  if (relation.type === 'one') {                                                   // 30\n    related = ForeignCollection.findOne(selector);                                 // 31\n  } else if (relation.type === 'many') {                                           // 32\n    related = ForeignCollection.find(selector);                                    // 33\n  }                                                                                // 34\n                                                                                   // 35\n  // Assing the related object to the \"_references\" object for further use.        // 36\n  return this._references[relationName] = related;                                 // 37\n};                                                                                 // 38\n                                                                                   // 39\nrelationsOnInitModule = function() {                                               // 40\n  _.extend(Astro.BaseClass.prototype, methods);                                    // 41\n};                                                                                 // 42\n                                                                                   // 43\n/////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n/////////////////////////////////////////////////////////////////////////////////////\n//                                                                                 //\n// packages/jagi:astronomy-relations/lib/module/init_class.js                      //\n//                                                                                 //\n/////////////////////////////////////////////////////////////////////////////////////\n                                                                                   //\nvar checks = {};                                                                   // 1\n                                                                                   // 2\nchecks.relationName = function(relationName) {                                     // 3\n  // Check if the field name had been provided and is a string.                    // 4\n  if (!_.isString(relationName)) {                                                 // 5\n    throw new Error(                                                               // 6\n      'The relation name in the \"' + this.getName() +                              // 7\n      '\" class schema has to be a string'                                          // 8\n    );                                                                             // 9\n  }                                                                                // 10\n};                                                                                 // 11\n                                                                                   // 12\nchecks.definitions = function(relationsDefinition) {                               // 13\n  if (!_.isObject(relationsDefinition)) {                                          // 14\n    // Relations definition has to be an object.                                   // 15\n    throw new Error(                                                               // 16\n      'The relations definition in the \"' + this.getName() +                       // 17\n      '\" class schema has to be an object'                                         // 18\n    );                                                                             // 19\n  }                                                                                // 20\n};                                                                                 // 21\n                                                                                   // 22\nchecks.definition = function(relationName, relationDefinition) {                   // 23\n  if (!_.isObject(relationDefinition)) {                                           // 24\n    // Relation definition has to be an object.                                    // 25\n    throw new Error(                                                               // 26\n      'The relation definition for the \"' + relationName +                         // 27\n      '\" relation in the \"' + this.getName() +                                     // 28\n      '\" class schema has to be an object'                                         // 29\n    );                                                                             // 30\n  }                                                                                // 31\n                                                                                   // 32\n  if (relationDefinition.type !== 'one' && relationDefinition.type !== 'many') {   // 33\n    // Relation type should be one of two values: \"one\" or \"many\".                 // 34\n    throw new Error(                                                               // 35\n      'The relation type for the \"' + relationName +                               // 36\n      '\" relation in the \"' + this.getName() +                                     // 37\n      '\" class schema should be \"one\" or \"many\"'                                   // 38\n    );                                                                             // 39\n  }                                                                                // 40\n};                                                                                 // 41\n                                                                                   // 42\nvar methods = {};                                                                  // 43\n                                                                                   // 44\nmethods.hasRelation = function(relationName) {                                     // 45\n  checks.relationName.call(this, relationName);                                    // 46\n                                                                                   // 47\n  return _.has(this.schema.relations, relationName);                               // 48\n};                                                                                 // 49\n                                                                                   // 50\nmethods.getRelation = function(relationName) {                                     // 51\n  checks.relationName.call(this, relationName);                                    // 52\n                                                                                   // 53\n  return this.schema.relations[relationName];                                      // 54\n};                                                                                 // 55\n                                                                                   // 56\nmethods.getRelations = function() {                                                // 57\n  return this.schema.relations;                                                    // 58\n};                                                                                 // 59\n                                                                                   // 60\nmethods.addRelations = function(relationsDefinition) {                             // 61\n  checks.definitions.call(this, relationsDefinition);                              // 62\n                                                                                   // 63\n  _.each(relationsDefinition, function(relationDefinition, relationName) {         // 64\n    this.addRelation(relationName, relationsDefinition[relationName]);             // 65\n  }, this);                                                                        // 66\n};                                                                                 // 67\n                                                                                   // 68\n                                                                                   // 69\nmethods.addRelation = function(relationName, relationDefinition) {                 // 70\n  // Do params checking. The params checking can throw an error.                   // 71\n  checks.relationName.call(this, relationName);                                    // 72\n  // If the relation already exists then just break. When adding relation, we also try to add an opposit relation to the foreign schema. It could cause circular method execution. It's why we have to stop execution.\n  if (this.hasRelation(relationName)) {                                            // 74\n    return;                                                                        // 75\n  }                                                                                // 76\n  checks.definition.call(this, relationName, relationDefinition);                  // 77\n                                                                                   // 78\n  // Define setter and getter for the relation.                                    // 79\n  Object.defineProperty(this.prototype, relationName, {                            // 80\n    get: function() {                                                              // 81\n      return this.getRelated(relationName);                                        // 82\n    },                                                                             // 83\n    set: function(value) {                                                         // 84\n      this.setRelated(relationName, value);                                        // 85\n    }                                                                              // 86\n  });                                                                              // 87\n                                                                                   // 88\n  // Add relation definition to the schema.                                        // 89\n  this.schema.relations[relationName] = relationDefinition;                        // 90\n};                                                                                 // 91\n                                                                                   // 92\nrelationsOnInitClass = function(schemaDefinition) {                                // 93\n  var Class = this;                                                                // 94\n                                                                                   // 95\n  _.extend(Class, methods);                                                        // 96\n                                                                                   // 97\n  // Add the \"relations\" attribute to the schema.                                  // 98\n  Class.schema.relations = {};                                                     // 99\n                                                                                   // 100\n  if (_.has(schemaDefinition, 'relations')) {                                      // 101\n    Class.addRelations(schemaDefinition.relations);                                // 102\n  }                                                                                // 103\n};                                                                                 // 104\n                                                                                   // 105\n/////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n/////////////////////////////////////////////////////////////////////////////////////\n//                                                                                 //\n// packages/jagi:astronomy-relations/lib/module/init_instance.js                   //\n//                                                                                 //\n/////////////////////////////////////////////////////////////////////////////////////\n                                                                                   //\nrelationsOnInitInstance = function() {                                             // 1\n  // Object for storing references of related objects.                             // 2\n  this._references = {};                                                           // 3\n};                                                                                 // 4\n                                                                                   // 5\n/////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n\n\n\n\n\n\n(function () {\n\n/////////////////////////////////////////////////////////////////////////////////////\n//                                                                                 //\n// packages/jagi:astronomy-relations/lib/module/module.js                          //\n//                                                                                 //\n/////////////////////////////////////////////////////////////////////////////////////\n                                                                                   //\nAstro.createModule({                                                               // 1\n  name: 'relations',                                                               // 2\n  init: relationsOnInitModule,                                                     // 3\n  events: {                                                                        // 4\n    initclass: relationsOnInitClass,                                               // 5\n    initinstance: relationsOnInitInstance                                          // 6\n  }                                                                                // 7\n});                                                                                // 8\n                                                                                   // 9\n/////////////////////////////////////////////////////////////////////////////////////\n\n}).call(this);\n"]}}]